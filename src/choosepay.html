{% extends "template.html" %}

{% block title %} Payment {% endblock %}

{% block content  %}

<div class="payment">
	Choose payment method
	<div class="preview">
		PLACEHOLDER FOR UPDATED ORDER
	</div>

	<table>
		<tr>
			<td></td>
			<td><button class="button" type="button" name="back-button" onclick="location.href='/payment-pages/{{OrderID}}?page=payment'">BACK</button></td>
			<td></td>
			<td><button class="button" type="button" name="cash-button" onclick="location.href='/payment-pages/{{OrderID}}?page=cash'">Kontant</button></td>
			<!-- https://stripe.com/docs/checkout#integration-custom -->
			
			<td rowspan="2" colspan="2"><div  type="button" name="PayPal" id=paypalbtn></button></td>
				<script src="https://www.paypalobjects.com/api/checkout.js"></script>
	<script>
	// Render the PayPal button
	paypal.Button.render({
	// Set your environment
	env: 'sandbox', // sandbox | production

	// Specify the style of the button
	style: {
	  layout: 'vertical',  // horizontal | vertical
	  size:   'medium',    // medium | large | responsive
	  shape:  'rect',      // pill | rect
	  color:  'black'       // gold | blue | silver | white | black
	},

	// Specify allowed and disallowed funding sources
	//
	// Options:
	// - paypal.FUNDING.CARD
	// - paypal.FUNDING.CREDIT
	// - paypal.FUNDING.ELV
	funding: {
	  allowed: [
		paypal.FUNDING.CARD,
		paypal.FUNDING.CREDIT
	  ],
	  disallowed: []
	},

	// PayPal Client IDs - replace with your own
	// Create a PayPal app: https://developer.paypal.com/developer/applications/create
	client: {
	  sandbox: 'AZDxjDScFpQtjWTOUtWKbyN_bDt4OgqaF4eYXlewfBP4-8aqX3PiV8e1GWU6liB2CUXlkA59kJXE7M6R',
	  production: '<insert production client id>'
	},

	payment: function (data, actions) {
	  return actions.payment.create({
		payment: {
		  transactions: [
			{
			  amount: {
				total: '{{ FinalPrice }}', //need to insert updated value for total ammount
				currency: 'NOK'
			  }
			}
		  ]
		}
	  });
	},

	onAuthorize: function (data, actions) {
	  return actions.payment.execute()
		.then(function () {
			function reqListener () {
  console.log(this.responseText);
}
var oReq = new XMLHttpRequest();
oReq.addEventListener("load", reqListener);
oReq.open("PUT", '/paypal-payment/{{OrderID}}');
oReq.send();
		  window.alert('Payment Complete!');
		});
	}
	}, '#paypalbtn');
	</script>

			<td class="nospace"></td>
			<td></td>
			<td></td>
		</tr>
	</table>



{% endblock %}
